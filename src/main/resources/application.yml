info.app:
  name: Hmpps Interventions Service
  version: 1.0

spring:
  main:
    banner-mode: off
  application:
    name: hmpps-interventions-service
  codec:
    max-in-memory-size: 10MB
  jackson:
    date-format: "yyyy-MM-dd HH:mm:ss"
    mapper:
      default-view-inclusion: true
    serialization:
      WRITE_DATES_AS_TIMESTAMPS: false
  security:
    oauth2:
      client:
        provider:
          hmppsauth:
            token-uri: ${hmppsauth.baseurl}/oauth/token
            token-request:
              connect-timeout-ms: 500
              read-timeout-ms: 500
              retries: 3
              retry-delay-ms: 500
        registration:
          interventions-client:
            provider: hmppsauth
            authorization-grant-type: client_credentials
            scope: read,write
      resourceserver:
        jwt:
          issuer-uri: ${hmppsauth.baseurl}/issuer
          jwk-set-uri: ${hmppsauth.baseurl}/.well-known/jwks.json
  datasource:
    url: jdbc:postgresql://${postgres.uri}/${postgres.db}
    username: ${postgres.username}
    password: ${postgres.password}
  jpa:
    hibernate:
      ddl-auto: validate
      dialect: PostgreSQLDialect
    show-sql: false
  batch:
    job:
      enabled: false  # don't run jobs at application startup
    jdbc:
      initialize-schema: never # we manage the spring batch schema with our own migrations
    concurrency:
      pool-size: 1 # run one job at a time...
      queue-size: 10000 # unless the number of queued jobs exceeds this number
    jobs:
      service-provider:
        performance-report:
          page-size: 100
          chunk-size: 20
      ndmis:
        performance-report:
          page-size: 100
          chunk-size: 20
  data:
    web:
      pageable:
        one-indexed-parameters: true

server:
  port: 8080
  servlet:
    context-path: /
  forward-headers-strategy: native
  tomcat:
    remoteip:
      remote-ip-header: x-forwarded-for
      protocol-header: x-forwarded-proto
      internal-proxies: 10\.\d{1,3}\.\d{1,3}\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|169\.254\.\d{1,3}\.\d{1,3}|127\.\d{1,3}\.\d{1,3}\.\d{1,3}|172\.1[6-9]{1}\.\d{1,3}\.\d{1,3}|172\.2[0-9]{1}\.\d{1,3}\.\d{1,3}|172\.3[0-1]{1}\.\d{1,3}\.\d{1,3}|0:0:0:0:0:0:0:1|::1|100\.6[4-9]\.\d{1,3}\.\d{1,3}|100\.[7-9][0-9]{1}\.\d{1,3}\.\d{1,3}|100\.1[0-1][0-9]{1}\.\d{1,3}\.\d{1,3}|100\.12[0-7]\.\d{1,3}\.\d{1,3}
  shutdown: graceful
  error:
    include-message: always

management:
  endpoints:
    web:
      base-path: /
      exposure:
        include: 'info, health, prometheus'
  endpoint:
    health:
      cache:
        time-to-live: 2000ms
      show-components: always
      show-details: always
      probes:
        enabled: true
    info:
      cache:
        time-to-live: 2000ms

notify:
  enabled: true
  templates:
    referral-sent: "336f2158-d130-4c63-a59b-da12df15a5a3"
    referral-assigned: "f0fe2fce-df0f-46c0-839a-822037d39c28"
    action-plan-submitted: "83743b43-9abb-4ffb-913d-dc583ab22dbf"
    action-plan-approved: "f060e1ae-c2a6-4752-ad20-436120c5880b"
    appointment-not-attended: "9c857bea-dd01-4154-861b-ef8124eae178"
    concerning-behaviour: "b17e35d8-8237-4de1-a3d9-45fe83689457"
    end-of-service-report-submitted: "f79cb53f-dc5c-42aa-947e-f599f9ad7942"
    initial-assessment-scheduled: "28256bed-6433-485c-857d-cb52a7937dff"
    service-provider-performance-report-ready: "9839e772-cd88-435d-9d18-61ea14d3531b"
    service-provider-performance-report-failed: "b4a09047-bf01-4ca1-ba55-f08bcce524f2"
    case-note-sent: "83868039-3d42-4af6-86da-df14e9d4a8b7"
    completion-deadline-updated: "fb5c9bc1-3131-49aa-8aeb-6138208406d1"
    enforceable-days-updated: "eef5834f-3a33-46e1-a937-a8bf0e3320c0"
    complexity-level-changed: "824900b1-7c06-4594-984d-310b1b46098a"
    desired-outcome-changed: "817ce0e0-3efd-4bc9-a65d-e3e32e78c404"
    needs-and-requirements-outcome-changed: "41d31358-1e87-41e4-a84f-10006cf64423"
    referral-cancelled: "b15ca66f-94a8-41ff-960f-5933cb8be841"

interventions-ui:
  locations:
    service-provider:
      referral-details: "/service-provider/referrals/{id}/details"
      intervention-progress: "/service-provider/referrals/{id}/progress"
      action-plan: "/service-provider/referrals/{id}/action-plan"
      download-report: "/service-provider/performance-report/download?filename={filename}"
      case-note-details: "/service-provider/case-note/{id}"
    probation-practitioner:
      referral-details: "/probation-practitioner/referrals/{id}/details"
      intervention-progress: "/probation-practitioner/referrals/{id}/progress"
      supplier-assessment: "/probation-practitioner/referrals/{id}/supplier-assessment"
      action-plan: "/probation-practitioner/referrals/{id}/action-plan"
      session-feedback: "/probation-practitioner/referrals/{id}/session/{sessionNumber}/appointment/{appointmentId}/post-session-feedback"
      supplier-assessment-feedback: "/probation-practitioner/referrals/{id}/supplier-assessment/post-assessment-feedback"
      end-of-service-report: "/probation-practitioner/end-of-service-report/{id}"
      case-note-details: "/probation-practitioner/case-note/{id}"

refer-and-monitor-and-delius:
  locations:
    appointment-merge: "/probation-case/{crn}/referrals/{referralId}/appointments"
    case-access: "/users/{username}/access"
    case-identifiers: "/probation-case/{crn}/identifiers"
    managed-cases: "/users/{username}/managed-cases"
    referral-start: "/probation-case/{crn}/referrals"
    responsible-officer: "/probation-case/{crn}/responsible-officer"

community-api:
  appointments:
    bookings:
      enabled: true
    outcome:
      enabled: true
    office-location: CRSEXTL
    notes-field-qualifier: "{
      SERVICE_DELIVERY:'Service Delivery',
      SUPPLIER_ASSESSMENT:'Supplier Assessment'
      }"
    counts-towards-rar-days: "{
      SERVICE_DELIVERY:true,
      SUPPLIER_ASSESSMENT:false
      }"
  referrals:
      enabled: true
  integration-context: commissioned-rehabilitation-services

manage-users:
  api:
    locations:
      auth-user-groups: "/externalusers/{userId}/groups"
      auth-user-detail: "/externalusers/{username}"
      user-email: "/users/{username}/email"
      user-detail: "/users/{username}"

assess-risks-and-needs:
  locations:
    create-supplementary-risk: "/risks/supplementary"

prisoner-offender-search:
  locations:
    prisoner: "/prisoner/{nomsId}"

aws:
  s3:
    storage:
      enabled: false
      region: eu-west-2
    ndmis:
      enabled: false
      region: eu-west-2
  sns:
    enabled: true
    provider: aws
    region: eu-west-2

webclient:
  connect-timeout-seconds: 20
  read-timeout-seconds: 10
  write-timeout-seconds: 10
  hmpps-auth:
    max-retry-attempts: 2
    connect-timeout-seconds: 20
    read-timeout-seconds: 3
  manage-users:
    max-retry-attempts: 2
    connect-timeout-seconds: 20
    read-timeout-seconds: 3

overrides:
  show-future-interventions: false

feature-flags:
  current-location:
    enabled: true
  save-probation-practitioner-details:
    enabled: true

appointment:
  ids: 82e2fbbe-1bb4-4967-8ee6-81aa072fd44b
